---
title: "Equipo 4"
author: ""
date: "18/1/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Equipo conformado por: 

### Deister Navarro Derek 

### Dimas Ramirez Luis Daniel 

### Hernandez Molina Marlene Zoobeida 

### Hernandez Silva Hatziri 

### Krauss Guzman Alexis 

### Ortiz Vega Miroslava Guadalupe

<br></br>

Este conjunto de datos proporciona datos desde el 1 de enero de 2013 hasta el 24 de abril de 2017 en la ciudad de Delhi, India. 

La  **variables** son :la temperatura media, la humedad, la presión media.




<br></br>


<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-buh4{background-color:#f9f9f9;text-align:left;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-btxf{background-color:#f9f9f9;border-color:inherit;text-align:left;vertical-align:top}
</style>
<table class="tg">
<thead>
  <tr>
    <th class="tg-0pky">Variable </th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-btxf">Temperatura media.</td>
    <td class="tg-btxf">Promediada a partir de múltiples intervalos de 3 horas en un día.</td>
    <td class="tg-btxf">Variable dependiente</td>
  </tr>
  <tr>
    <td class="tg-0pky">Humedad</td>
    <td class="tg-0pky">Gramos de vapor de agua por metro cúbico de volumen de aire</td>
    <td class="tg-0pky">Variable explicativa.</td>
  </tr>
  <tr>
    <td class="tg-buh4">Presión media</td>
    <td class="tg-buh4">Medida en atm(atmósfera estándar)</td>
    <td class="tg-buh4">Variable explicativa.</td>
      </tr>
  <tr>
    <td class="tg-0pky">Velocidad del viento</td>
    <td class="tg-0pky">KM/H</td>
    <td class="tg-0pky">Variable explicativa.</td>
  </tr>
</tbody>
</table>

<br></br>


```{r}

library(readr)
library(readxl)
library(lubridate)
data <- read_csv("C:/Marlene personal/Diploma/Econometria/DatosEconometria/DailyDelhiClimateTrain.csv")
f=data.frame(data)

  
  
DT::datatable(f, editable = 'cell-border stripe')


```

<br></br>




# Modelo LIN-LIN
```{r}

model_linlin <- lm( data$temperatura~ data$humedad + data$presion + data$velocidad_viento)
model_linlin
summary(model_linlin)
```

Interpretación: 
Si la humedad y la presion fuera 0, la temperatura promedio seria 42.28
Si la unidad de humedad aumenta en uno, la temp cae en 0.25 
Si la unidad de presion aumenta en uno, la temp cae en 0.0015 

Segun el $r2$ ajustado; el 33.37% del comportamiento de la temperatura es descrita por nuestro modelo.El otro 66.16% se debe al error.  


```{r}
a <- aov(model_linlin)
summary(a)
```

De la tabla ANOVA podemos observar que que la variable presión es menos significativa. Por lo tanto con una confianza del 92.4% podemos decir que existe suficiente evidencia estadistica para rechazar la hipotesis de que la presion describe el comporamiento de la temperatura. 

# Modelo LOG-LOG
```{r}
model_longlong <- lm( log(data$temperatura)~ log(data$humedad) + log(data$presion) )


model_longlong 
exp(model_longlong$coefficients)
summary(model_longlong)
```

Interpretación: 
Si la humedad y el y la presion fuera 0, la humedad crece a una taza de 500.82%. 
Si la humedad aumenta en 1% la temp se reduce en 54.59%
Si la presion  aumenta en 1% la temp se reduce en 6.026%

En este caso no se utilizo la velocidad del viento debido a que tiene valores nulos los cuales no podemos modelarlos con la funcion de logaritmo. 

 $r^2$ Ajustado: El 27.73% del comportamiento de nuesrta varialbe dependiente es descrita por el modelo. 

```{r}
a_longlong <- aov(model_longlong)
summary(a_longlong)
```

# Modelo LOG-LIN
```{r}
model_longlin <- lm( log(data$temperatura)~ data$humedad + data$presion + data$velocidad_viento) 
model_longlin 
exp(model_longlin$coefficients)
summary(model_longlin)
```

Interpretación: 

Si la humedad y el y la presion fuera 0, la humedad crece a una taza de 39%. 
Si la humedad aumenta en 1% la temp se reduce en 0.102
Si la presion  aumenta en 1% la temp se reduce en 0.006197

 $r^2$ Ajustado: El comportamiendo de la temperatura es descrito en un 31.1% por nuestro modelo. 

```{r}
a_longlin <- aov(model_longlin)
summary(a_longlin)
```

En este caso que volvemos a incluir la variable de velocidad del viento, confirmamos nuevamente que esta variable es más significativa que la variable presión. 

# Modelo LIN-LOG
```{r}
model_linlong <- lm(data$temperatura~ log(data$humedad) + log(data$presion)) 
model_linlong 
exp(model_linlong$coefficients)
summary(model_linlong)
```

Interpretación: 
Si la humedad y el y la presion fuera 0, la temperatura promedio es de 85.313
Si la humedad aumenta en 1% la temp se reduce en 12.67
Si la presion  aumenta en 1% la temp se reduce en 1.211

 $r^2$ Ajustado: El comportamiendo de la temperatura es descrito en un 31.14% por nuestro modelo. 

```{r}
a_linlong <- aov(model_linlong)
summary(a_linlong)
```




LIN-LIN hasta ahora, teniendo en cuenta la significancia de nuestras variables, el estadistico F, p-values y $r^2$ ajustado; es nuestro mejor modelo.

# Modelo LIN-LIN
```{r}

model_lin_lin1 <- lm( data$temperatura~ data$humedad + data$presion + data$velocidad_viento)
model_lin_lin1
summary(model_lin_lin1)
```

Errores
```{r}
plot(model_lin_lin1$residuals, type = "l", col= "red", main="Modelo lin-lin", xlab="Periodo", ylab="Errores")
```

Transformación a serie de tiempo
```{r}
tsTemp<-ts(data$temperatura,start=decimal_date(as.Date("2013-01-01")),frequency=365)
tsHumi<-ts(data$humedad,start=decimal_date(as.Date("2013-01-01")),frequency=365)
tsPress<-ts(data$presion,start=decimal_date(as.Date("2013-01-01")),frequency=365)
```


```{r}
tsWind<-ts(data$velocidad_viento,start=decimal_date(as.Date("2013-01-01")),frequency=365)
```

Diferencias
```{r}
difTemp<-diff(tsTemp,diff=1,lag=1)
difHumi<-diff(tsHumi,diff=1,lag=1)
difPress<-diff(tsPress,diff=1,lag=1)
difWind<-diff(tsWind,diff=1,lag=1)

model_lin_lin_diff<-lm(difTemp~ difHumi+difPress+difWind)
model_lin_lin_diff$coefficients
summary(model_lin_lin_diff)
```

Errores
```{r}
plot(model_lin_lin_diff$residuals, type = "l", col= "red", main="Modelo lin-lin", xlab="Periodo", ylab="Errores")
```

Autocorrelaciones 

```{r}

acf(data$temperatura, lag.max = NULL, type = c('correlation'), plot = TRUE, demean =  TRUE)

acf(data$temperatura, lag.max = NULL, type = c('partial'), plot = TRUE, demean =  TRUE)



```
Correlaciones parciales 

```{r}

acf(difTemp, lag.max = NULL, type = c('correlation'), plot = TRUE, demean =  TRUE)

acf(difTemp, lag.max = NULL, type = c('partial'), plot = TRUE, demean =  TRUE)

#tsTemp

```
```{r}

library(forecast)
modelo = auto.arima(data$temperatura,stepwise=FALSE,approximation= FALSE)

```
```{r}
summary(modelo)


```


```{r}
arima(data$temperatura, order = c(2,1,2), seasonal = c(0,0,4), include.mean = FALSE, method = c('CSS-ML'))
```

```{r}
library(gridExtra)
library(pracma)
library(DescTools)
library(data.table)

Prom_simp<-mean(difTemp)
mae_PromSimp<-MAE(data$temperatura,Prom_simp)
mape_PromSimp<-MAPE(data$temperatura,Prom_simp)
smape_PromSimp<-SMAPE(tsTemp,Prom_simp)
mse_PromSimp<-MSE(tsTemp,Prom_simp)
rmse_PromSimp<-RMSE(tsTemp,Prom_simp)
medidas_PromSimp<-matrix(c(mae_PromSimp,mape_PromSimp,smape_PromSimp,mse_PromSimp,rmse_PromSimp))
rownames(medidas_PromSimp)<-c("MAE","MAPE","SMAPE","MSE","RMSE")
colnames(medidas_PromSimp)<-c("Prom.Simple")
df_medidas_PromSimp<-as.data.frame(medidas_PromSimp)
tab_medidas_PromSimp<-as.data.table(df_medidas_PromSimp,keep.rownames=TRUE, keep.colnames=FALSE)
colnames(tab_medidas_PromSimp)<-c("Medida","Promedio Simple")
ftab_medidas_PromSimp<-format(tab_medidas_PromSimp, digits=5,scientific=FALSE,big.mark=",",decimal.mark=".",small.mark=",",justify="right")
tem<-ttheme_minimal(base_colour = "black",base_size = 15,core=list(bg_params=list(fill=blues9,col=NA)))
grid.arrange(tableGrob(ftab_medidas_PromSimp,theme=tem))
```


```{r}

library(forecast)
ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.5)

```
```{r}
est<-ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.5)
fse<-est$fitted
fse_ts<-ts(fse,start=1,frequency=1)
fset_ts<-rep(0,20)
for(t in 3:20) fset_ts[t]<-fse_ts[t-2]
for(t in 1:2) fset_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fset_ts,xlab=NULL,ylab=NULL, main = "Serie Suavizada Exponencialmente",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Suavizada"),col=c(1,2),lty=c(1,2))

```

```{r}
library(forecast)
ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.8)

```

```{r}
est<-ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.8)
fse<-est$fitted
fse_ts<-ts(fse,start=1,frequency=1)
fset_ts<-rep(0,20)
for(t in 3:20) fset_ts[t]<-fse_ts[t-2]
for(t in 1:2) fset_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fset_ts,xlab=NULL,ylab=NULL, main = "Serie Suavizada Exponencialmente",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Suavizada"),col=c(1,2),lty=c(1,2))

```
```{r}

ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.1, exponential = TRUE, beta = NULL)
```
```{r}

estr<-ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.1, exponential = TRUE, beta = NULL)
fser<-estr$fitted
fser_ts<-ts(fser,start=1,frequency=1)
fsetr_ts<-rep(0,20)
for(t in 3:20) fsetr_ts[t]<-fser_ts[t-2]
for(t in 1:2) fsetr_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fsetr_ts,xlab=NULL,ylab=NULL, main = "Serie Suavizada Exponencialmente con Ajuste de Tendencia",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Suavizada"),col=c(1,2),lty=c(1,2))
```


```{r}
ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.5, exponential = TRUE, beta = NULL)
```
```{r}
estr<-ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.5, exponential = TRUE, beta = NULL)
fser<-estr$fitted
fser_ts<-ts(fser,start=1,frequency=1)
fsetr_ts<-rep(0,20)
for(t in 3:20) fsetr_ts[t]<-fser_ts[t-2]
for(t in 1:2) fsetr_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fsetr_ts,xlab=NULL,ylab=NULL, main = "Serie Suavizada Exponencialmente con Ajuste de Tendencia",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Suavizada"),col=c(1,2),lty=c(1,2))

```
```{r}
ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.8, exponential = TRUE, beta = NULL)


```
```{r}
estr<-ses(tsTemp, h = 2, level = c(95, 95), initial = c("simple"),  alpha = 0.8, exponential = TRUE, beta = NULL)
fser<-estr$fitted
fser_ts<-ts(fser,start=1,frequency=1)
fsetr_ts<-rep(0,20)
for(t in 3:20) fsetr_ts[t]<-fser_ts[t-2]
for(t in 1:2) fsetr_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fsetr_ts,xlab=NULL,ylab=NULL, main = "Serie Suavizada Exponencialmente con Ajuste de Tendencia",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Suavizada"),col=c(1,2),lty=c(1,2))

```

```{r}
mae_y <- MAE(data$temperatura,fser)

mape_y <- MAPE(data$temperatura,fser)

smape_y <- SMAPE(data$temperatura,fser)
mse_y <- MSE(data$temperatura,fser)

rmse_y <- RMSE(data$temperatura,fser)

medidas_ym<-matrix(c(mae_y,mape_y,smape_y,mse_y,rmse_y))
rownames(medidas_ym)<-c("MAE","MAPE","SMAPE","MSE","RMSE")
colnames(medidas_ym)<-c("Prom.Modificado")

tab_medidas_ym<-as.data.table(medidas_ym,keep.rownames=TRUE, keep.colnames=FALSE)
colnames(tab_medidas_ym)<-c("Medida","Promedio Simple")
ftab_medidas_ym<-format(tab_medidas_ym, digits=5,scientific=FALSE,big.mark=",",decimal.mark=".",small.mark=",",justify="right")
tem<-ttheme_minimal(base_colour = "black",base_size = 15,core=list(bg_params=list(fill=blues9,col=NA)))
grid.arrange(tableGrob(ftab_medidas_ym,theme=tem))

```
```{r}
holt(tsTemp, h = 2, level = c(0.95, 0.95), initial = c("simple"),  alpha = NULL, beta = NULL)

```

```{r}
esth<-holt(tsTemp, h = 2, level = c(0.95, 0.95), initial = c("simple"),  alpha = NULL, beta = NULL)
fh<-esth$fitted
fh_ts<-ts(fh,start=1,frequency=1)
fht_ts<-rep(0,20)
for(t in 3:20) fht_ts[t]<-fh_ts[t-2]
for(t in 1:2) fht_ts[t]<-NA
yt<-rep(0,20)
for(t in 1:18) yt[t]<-tsTemp[t]
for(t in 19:20) yt[t]<-NA
yt_ts<-ts(yt,start=1,frequency=1)
ts.plot(yt_ts,fht_ts,xlab=NULL,ylab=NULL, main = "Pronóstico de Holt",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","Holt"),col=c(1,2),lty=c(1,2))

```

```{r}

mae__yh <- MAE(data$temperatura,fh)

mape__yh <- MAPE(data$temperatura,fh)

smape__yh <- SMAPE(data$temperatura,fh)
mse__yh <- MSE(data$temperatura,fh)

rmse__yh <- RMSE(data$temperatura,fh)

medidas__yh<-matrix(c(mae__yh,mape__yh,smape__yh,mse__yh,rmse__yh))
rownames(medidas__yh)<-c("MAE","MAPE","SMAPE","MSE","RMSE")
colnames(medidas__yh)<-c("Prom.Modificado2")

tab_medidas__yh<-as.data.table(medidas__yh,keep.rownames=TRUE, keep.colnames=FALSE)
colnames(tab_medidas__yh)<-c("Medida","Promedio Simple")
ftab_medidas__yh<-format(tab_medidas__yh, digits=5,scientific=FALSE,big.mark=",",decimal.mark=".",small.mark=",",justify="right")
tem<-ttheme_minimal(base_colour = "black",base_size = 15,core=list(bg_params=list(fill=blues9,col=NA)))
grid.arrange(tableGrob(ftab_medidas__yh,theme=tem))

```



```{r}
esth$model

```
```{r}

hw(tsTemp, h = 2, level = c(0.95, 0.95), initial = c("simple"),  seasonal = c('multiplicative'), alpha = NULL, beta = NULL, gamma = NULL)

```
```{r}
est_hwm<-hw(tsTemp, h = 2, seasonal = c("multiplicative"),level = c(80, 95),initial = c("simple"), alpha = NULL, beta = NULL, gamma = NULL)
fhwm<-est_hwm$fitted
fhwm_ts<-ts(fhwm,start=c(2012,3),frequency=4)
fhwmt_ts<-rep(0,32)
for(t in 3:32) fhwmt_ts[t]<-fhwm_ts[t-2]
for(t in 1:2) fhwmt_ts[t]<-NA
yt<-rep(0,32)
for(t in 1:30) yt[t]<-tsTemp[t]
for(t in 31:32) yt[t]<-NA
yt_ts<-ts(yt,start=c(2012,3),frequency=4)
ts.plot(yt_ts,fhwmt_ts,xlab=NULL,ylab=NULL, main = "Pronóstico de Holt-Winters Multiplicativo",lty=c(1:2),col=c(1,2))
legend(x="bottomright",legend=c("Obs","HoltWM"),col=c(1,2),lty=c(1,2))

```
```{r}
est_hwm$model
```


```{r}

mae__yhm <- MAE(data$temperatura,fhwm)

mape__yhm <- MAPE(data$temperatura,fhwm)

smape__yhm <- SMAPE(data$temperatura,fhwm)
mse__yhm <- MSE(data$temperatura,fhwm)

rmse__yhm <- RMSE(data$temperatura,fhwm)

medidas__yhm<-matrix(c(mae__yhm,mape__yhm,smape__yhm,mse__yhm,rmse__yhm))
rownames(medidas__yhm)<-c("MAE","MAPE","SMAPE","MSE","RMSE")
colnames(medidas__yhm)<-c("Prom.Modificado2")

tab_medidas__yhm<-as.data.table(medidas__yhm,keep.rownames=TRUE, keep.colnames=FALSE)
colnames(tab_medidas__yhm)<-c("Medida","Promedio Simple")
ftab_medidas__ym <-format(tab_medidas__ym, digits=5,scientific=FALSE,big.mark=",",decimal.mark=".",small.mark=",",justify="right")
tem<-ttheme_minimal(base_colour = "black",base_size = 15,core=list(bg_params=list(fill=blues9,col=NA)))
grid.arrange(tableGrob(tab_medidas__yhm,theme=tem))

```
```{r}

hw(tsTemp, h = 2, seasonal = c("additive"),level = c(80, 95),initial = c('optimal'), alpha = NULL, beta = NULL, gamma = NULL)
```


